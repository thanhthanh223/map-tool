<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ƒê∆∞·ªùng bao X√£ Vietnam</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: Arial, sans-serif; 
        }
        #map { 
            height: 100vh; 
            width: 100vw; 
        }
        h1 {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            margin: 0;
            z-index: 1000;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
        }
        .info { 
            padding: 15px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            font-size: 14px;
            line-height: 1.4;
        }
        .info h3 {
            font-size: 16px;
            margin: 0 0 10px 0;
            color: #333;
        }
        .info p {
            margin: 5px 0;
            font-size: 13px;
        }
        .info button {
            background: #007cba;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }
        .info button:hover {
            background: #005a87;
        }
    </style>
</head>
<body>
    <h1>ƒê∆∞·ªùng bao ƒê·ªãa gi·ªõi X√£ Vƒ©nh H·∫£i t·ª´ OSM Ways</h1>
    <div id="map"></div>

  <script>
        // T·ªça ƒë·ªô ƒëi·ªÉm c·∫ßn ki·ªÉm tra
        const testPoint = [20.6421984, 106.4579793];
        
        // Kh·ªüi t·∫°o b·∫£n ƒë·ªì t·∫≠p trung v√†o ƒëi·ªÉm ki·ªÉm tra v·ªõi t·ªâ l·ªá chu·∫©n OSM
        var map = L.map('map').setView(testPoint, 14);

        // Th√™m tile layer chu·∫©n c·ªßa OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // ƒê√°nh d·∫•u . ƒë·ªè c√°c ƒëi·ªÉm n√†y tr√™n b·∫£n ƒë·ªì
        const redPoints = [
            {id: 1336197283, lat: 20.6138317, lon: 106.4911370},
            {id: 1336203676, lat: 20.6288076, lon: 106.4534461},
            {id: 1336203851, lat: 20.6183543, lon: 106.4567335},
            {id: 1336211706, lat: 20.5994217, lon: 106.4703443},
            {id: 1336212539, lat: 20.6163037, lon: 106.4947231},
            {id: 1336214425, lat: 20.6160760, lon: 106.4959401},
            {id: 1336218225, lat: 20.6201809, lon: 106.4500743},
            {id: 1336218908, lat: 20.6252433, lon: 106.4515484},
            {id: 1336219035, lat: 20.6408065, lon: 106.4537629},
            {id: 1336228653, lat: 20.6105606, lon: 106.4680818},
            {id: 1336233584, lat: 20.6196732, lon: 106.4507583},
            {id: 1336245483, lat: 20.5989162, lon: 106.4706045},
            {id: 1336247543, lat: 20.6298574, lon: 106.4540036},
            {id: 1336255578, lat: 20.6169586, lon: 106.4612420},
            {id: 1336259647, lat: 20.6422750, lon: 106.4523709},
            {id: 1336260564, lat: 20.6158078, lon: 106.4631858},
            {id: 1336261166, lat: 20.6434766, lon: 106.4510385},
            {id: 1336276965, lat: 20.6502552, lon: 106.4452134},
            {id: 1336278349, lat: 20.6087916, lon: 106.4689371},
            {id: 1336278688, lat: 20.6393552, lon: 106.4547746},
            {id: 1336278740, lat: 20.6389320, lon: 106.4549728},
            {id: 1336282478, lat: 20.5986879, lon: 106.4708993},
            {id: 1336283944, lat: 20.6164679, lon: 106.4621599},
            {id: 1336284854, lat: 20.6134338, lon: 106.4909606},
            {id: 1336288565, lat: 20.6024838, lon: 106.4846646},
            {id: 1336289055, lat: 20.6185994, lon: 106.4549068},
            {id: 1336290606, lat: 20.6306955, lon: 106.4543183},
            {id: 1336292209, lat: 20.6246084, lon: 106.4512516},
            {id: 1336292618, lat: 20.6218231, lon: 106.4500917},
            {id: 1336293708, lat: 20.6080636, lon: 106.4692070},
            {id: 1336296679, lat: 20.6385053, lon: 106.4550184},
            {id: 1336296917, lat: 20.6164954, lon: 106.4926968},
            {id: 1336298201, lat: 20.6150632, lon: 106.4643377},
            {id: 1336311233, lat: 20.6172293, lon: 106.4605761},
            {id: 1336313023, lat: 20.6056004, lon: 106.4697564},
            {id: 1336313778, lat: 20.6095547, lon: 106.4896911},
            {id: 1336317439, lat: 20.6350382, lon: 106.4550818},
            {id: 1336321554, lat: 20.6003157, lon: 106.4826895},
            {id: 1336322077, lat: 20.6381617, lon: 106.4550719},
            {id: 1336324008, lat: 20.6125055, lon: 106.4906785},
            {id: 1336334206, lat: 20.6156206, lon: 106.5002285},
            {id: 1336336438, lat: 20.6190389, lon: 106.4527831},
            {id: 1336339952, lat: 20.6429011, lon: 106.4517048},
            {id: 1336341709, lat: 20.5982975, lon: 106.4780421},
            {id: 1336342210, lat: 20.6036345, lon: 106.4855956},
            {id: 1336342350, lat: 20.6135822, lon: 106.4660386},
            {id: 1336344478, lat: 20.6165554, lon: 106.4938437},
            {id: 1336344632, lat: 20.6067855, lon: 106.4695403},
            {id: 1336345898, lat: 20.6354614, lon: 106.4550998},
            {id: 1336349735, lat: 20.6273598, lon: 106.4526816},
            {id: 1336351913, lat: 20.6027309, lon: 106.4698919},
            {id: 1336354828, lat: 20.6375184, lon: 106.4550902},
            {id: 1336356094, lat: 20.6160279, lon: 106.4922635},
            {id: 1336376785, lat: 20.6281811, lon: 106.4531042},
            {id: 1336380638, lat: 20.6490111, lon: 106.4461949},
            {id: 1336384494, lat: 20.6012293, lon: 106.4699193},
            {id: 1336384769, lat: 20.6063283, lon: 106.4696303},
            {id: 1336385540, lat: 20.6359947, lon: 106.4551267},
            {id: 1336387050, lat: 20.5980357, lon: 106.4721390},
            {id: 1336387078, lat: 20.5982649, lon: 106.4774354},
            {id: 1336387462, lat: 20.6040175, lon: 106.4698917},
            {id: 1336394938, lat: 20.6154788, lon: 106.5020628},
            {id: 1336399414, lat: 20.6141300, lon: 106.4912780},
            {id: 1336401304, lat: 20.6189374, lon: 106.4533410},
            {id: 1336403028, lat: 20.6159801, lon: 106.4967557},
            {id: 1336415114, lat: 20.6042733, lon: 106.4861120},
            {id: 1336416272, lat: 20.6198594, lon: 106.4504342},
            {id: 1336420492, lat: 20.6167387, lon: 106.4616559},
            {id: 1336420913, lat: 20.5980525, lon: 106.4751731},
            {id: 1336424414, lat: 20.6184049, lon: 106.4561216},
            {id: 1336425237, lat: 20.6152285, lon: 106.4641322},
            {id: 1336426075, lat: 20.6474670, lon: 106.4473246},
            {id: 1336430859, lat: 20.6214675, lon: 106.4499838},
            {id: 1336431172, lat: 20.6161463, lon: 106.4626458},
            {id: 1336431958, lat: 20.6445174, lon: 106.4499673},
            {id: 1336435735, lat: 20.6209935, lon: 106.4499120},
            {id: 1336454007, lat: 20.6093502, lon: 106.4687210},
            {id: 1336454604, lat: 20.6166392, lon: 106.4931173},
            {id: 1336455407, lat: 20.5990664, lon: 106.4812439},
            {id: 1336460872, lat: 20.6187853, lon: 106.4541148},
            {id: 1336463932, lat: 20.6333973, lon: 106.4550198},
            {id: 1336465224, lat: 20.6087660, lon: 106.4893000},
            {id: 1336466180, lat: 20.6103835, lon: 106.4899732},
            {id: 1336472942, lat: 20.6033413, lon: 106.4853586},
            {id: 1336476153, lat: 20.6074034, lon: 106.4694052},
            {id: 1336477311, lat: 20.6522899, lon: 106.4437618},
            {id: 1336478845, lat: 20.6119087, lon: 106.4904669},
            {id: 1336480016, lat: 20.6145280, lon: 106.4914895},
            {id: 1336480570, lat: 20.6177792, lon: 106.4590551},
            {id: 1336487706, lat: 20.6010670, lon: 106.4833958},
            {id: 1336488017, lat: 20.6205872, lon: 106.4499301},
            {id: 1336491934, lat: 20.6501110, lon: 106.4453271},
            {id: 1336492587, lat: 20.6047879, lon: 106.4698466},
            {id: 1336493596, lat: 20.6294002, lon: 106.4538058},
            {id: 1336493925, lat: 20.6462100, lon: 106.4484907},
            {id: 1336494107, lat: 20.5987887, lon: 106.4807127},
            {id: 1336494460, lat: 20.6001066, lon: 106.4702229},
            {id: 1336497829, lat: 20.6017490, lon: 106.4699102},
            {id: 1336500197, lat: 20.6081345, lon: 106.4889661},
            {id: 1336507427, lat: 20.5994550, lon: 106.4818634},
            {id: 1336507947, lat: 20.5980033, lon: 106.4729886},
            {id: 1336508095, lat: 20.6241004, lon: 106.4509998},
            {id: 1336508219, lat: 20.6321685, lon: 106.4547318},
            {id: 1336511177, lat: 20.6511691, lon: 106.4445471},
            {id: 1336515210, lat: 20.6155246, lon: 106.5015984},
            {id: 1336516949, lat: 20.5985110, lon: 106.4799455},
            {id: 1336518697, lat: 20.6453806, lon: 106.4491570},
            {id: 1336518742, lat: 20.6343270, lon: 106.4550642},
            {id: 1336522303, lat: 20.6484695, lon: 106.4466450},
            {id: 1336524240, lat: 20.6193856, lon: 106.4514422},
            {id: 1336526634, lat: 20.6158124, lon: 106.4976222},
            {id: 1336529182, lat: 20.6269873, lon: 106.4524477},
            {id: 1336535827, lat: 20.6182698, lon: 106.4573094},
            {id: 1336542346, lat: 20.6157044, lon: 106.4989668},
            {id: 1336544370, lat: 20.6069996, lon: 106.4881640},
            {id: 1336545205, lat: 20.6150671, lon: 106.4916964},
            {id: 1336545827, lat: 20.6163996, lon: 106.4942388},
            {id: 1336551464, lat: 20.6166273, lon: 106.4935251},
            {id: 1336554701, lat: 20.6224242, lon: 106.4503165},
            {id: 1336560513, lat: 20.6314913, lon: 106.4545701},
            {id: 1336575954, lat: 20.6145469, lon: 106.4649407},
            {id: 1336581181, lat: 20.5999270, lon: 106.4823061},
            {id: 1336587666, lat: 20.6163636, lon: 106.4925183},
            {id: 1336590365, lat: 20.6403201, lon: 106.4541625},
            {id: 1336590823, lat: 20.6415640, lon: 106.4530551},
            {id: 1336591241, lat: 20.5983442, lon: 106.4790013},
            {id: 1336594674, lat: 20.6258359, lon: 106.4517822},
            {id: 1336596229, lat: 20.6077388, lon: 106.4886628},
            {id: 1336596621, lat: 20.6111792, lon: 106.4901848},
            {id: 1336597786, lat: 20.6326595, lon: 106.4548577},
            {id: 1336602218, lat: 20.6397106, lon: 106.4545405},
            {id: 1336604783, lat: 20.6160365, lon: 106.4962760},
            {id: 1336606682, lat: 20.6367227, lon: 106.4551084},
            {id: 1336611132, lat: 20.6232538, lon: 106.4506762},
            {id: 1336611849, lat: 20.6006211, lon: 106.4829847},
            {id: 1336612972, lat: 20.6125496, lon: 106.4668848},
            {id: 1336613449, lat: 20.6114577, lon: 106.4675777},
            {id: 1336615827, lat: 20.6180499, lon: 106.4582453},
            {id: 1336620366, lat: 20.6140730, lon: 106.4654987},
            {id: 1336621793, lat: 20.5981335, lon: 106.4717056},
            {id: 1336628434, lat: 20.6156443, lon: 106.4919832},
            {id: 1336635973, lat: 20.6192080, lon: 106.4520811},
            {id: 1336641613, lat: 20.6120333, lon: 106.4672897},
            {id: 1336643195, lat: 20.6155846, lon: 106.5005853},
            {id: 1336644464, lat: 20.6154525, lon: 106.4638158},
            {id: 1336645697, lat: 20.6130913, lon: 106.4664527},
            {id: 1336658876, lat: 20.6264455, lon: 106.4521418},
            {id: 2447429500, lat: 20.6683531, lon: 106.4561563},
            {id: 2447429503, lat: 20.6696494, lon: 106.4625465},
            {id: 8915626862, lat: 20.6683090, lon: 106.4577931},
            {id: 9282576788, lat: 20.6607357, lon: 106.4357668},
            {id: 9282605517, lat: 20.6523426, lon: 106.4437294},
            {id: 9282605519, lat: 20.6598953, lon: 106.4372493},
            {id: 9282605520, lat: 20.6584220, lon: 106.4387825},
            {id: 9282605522, lat: 20.6571656, lon: 106.4403527},
            {id: 9282605523, lat: 20.6564789, lon: 106.4409393},
            {id: 9282605524, lat: 20.6538369, lon: 106.4427673},
            {id: 10098286208, lat: 20.6277578, lon: 106.5071923},
            {id: 10098286209, lat: 20.6223041, lon: 106.5048194},
            {id: 10098286210, lat: 20.6192138, lon: 106.5034786},
            {id: 10098286211, lat: 20.6166096, lon: 106.5023388},
            {id: 10098286212, lat: 20.6158723, lon: 106.5021377},
            {id: 10098286213, lat: 20.6296874, lon: 106.5073897},
            {id: 10098286214, lat: 20.6311903, lon: 106.5033897},
            {id: 10098286215, lat: 20.6319731, lon: 106.5022847},
            {id: 10098286216, lat: 20.6400816, lon: 106.5071911},
            {id: 10098335417, lat: 20.6442854, lon: 106.5095123},
            {id: 10098335434, lat: 20.6358310, lon: 106.5046191},
            {id: 10098574568, lat: 20.6702396, lon: 106.4646651},
            {id: 10098574569, lat: 20.6694760, lon: 106.4651012},
            {id: 10098574570, lat: 20.6694478, lon: 106.4652167},
            {id: 10098574571, lat: 20.6685774, lon: 106.4653578},
            {id: 10098574572, lat: 20.6687515, lon: 106.4660507},
            {id: 10098574573, lat: 20.6676950, lon: 106.4666218},
            {id: 10098574574, lat: 20.6665938, lon: 106.4678759},
            {id: 10098574575, lat: 20.6657506, lon: 106.4687311},
            {id: 10098574576, lat: 20.6651494, lon: 106.4698695},
            {id: 10098574577, lat: 20.6617802, lon: 106.4680254},
            {id: 10098574599, lat: 20.6523890, lon: 106.4436995},
            {id: 10098574600, lat: 20.6607338, lon: 106.4697701},
            {id: 10098574601, lat: 20.6602724, lon: 106.4705098},
            {id: 10098574602, lat: 20.6572541, lon: 106.4815634},
            {id: 10098574603, lat: 20.6583990, lon: 106.4829351},
            {id: 10098574604, lat: 20.6586733, lon: 106.4834480},
            {id: 10098574605, lat: 20.6588104, lon: 106.4841389},
            {id: 10098574606, lat: 20.6587320, lon: 106.4846519},
            {id: 10098574607, lat: 20.6575666, lon: 106.4881393},
            {id: 10098574608, lat: 20.6568647, lon: 106.4881048},
            {id: 10098574609, lat: 20.6551548, lon: 106.4883031},
            {id: 10098574610, lat: 20.6552199, lon: 106.4905037},
            {id: 10098574611, lat: 20.6524955, lon: 106.4909099},
            {id: 10098574612, lat: 20.6501069, lon: 106.4967523},
            {id: 10098574613, lat: 20.6523105, lon: 106.4978111},
            {id: 10098574614, lat: 20.6533587, lon: 106.4984456},
            {id: 10098574615, lat: 20.6514442, lon: 106.5012280},
            {id: 10098580133, lat: 20.6626177, lon: 106.4396485},
            {id: 10098580134, lat: 20.6630327, lon: 106.4391041}
            // {id: 11516484334, lat: 20.6448819, lon: 106.4918034}
        ];

        // M·∫¢NG C√ÅC WAYS T·ª™ D·ªÆ LI·ªÜU OSM XML
        const osmWays = [
            // To save space, data remains as in the source (see above). Actually the logic below works for the full array.
            {
                id: "484366996",
                version: "11",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336298201", "1336575954", "1336620366", "1336342350", "1336645697",
                    "1336612972", "1336641613", "1336613449", "1336228653", "1336454007",
                    "1336278349", "1336293708", "1336476153", "1336344632", "1336384769",
                    "1336313023", "1336492587", "1336387462", "1336351913", "1336497829",
                    "1336384494", "1336494460", "1336211706", "1336245483", "1336282478",
                    "1336621793", "1336387050", "1336507947", "1336420913", "1336387078",
                    "1336341709", "1336591241", "1336516949", "1336494107", "1336455407",
                    "1336507427", "1336581181", "1336321554", "1336611849", "1336487706",
                    "1336288565", "1336472942", "1336342210"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1103557385",
                version: "2",
                changeset: "172280317",
                timestamp: "2025-09-22T08:15:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "10098286208", "10098286209", "10098286210", "10098286211", 
                    "10098286212", "1336394938"
                ],
                tags: {
                    "admin_level": "6",
                    "boundary": "administrative"
                }
            },
            {
                id: "1103557387",
                version: "2",
                changeset: "172280317",
                timestamp: "2025-09-22T08:15:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "10098286208", "10098286213", "10098286214", "10098286215", 
                    "10098335434"
                ],
                tags: {
                    "admin_level": "6",
                    "boundary": "administrative"
                }
            },
            {
                id: "1103557389",
                version: "5",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336596229", "1336500197", "1336465224", "1336313778", "1336466180",
                    "1336596621", "1336478845", "1336324008", "1336284854", "1336197283",
                    "1336399414", "1336480016", "1336545205", "1336628434", "1336356094",
                    "1336587666", "1336296917", "1336454604", "1336551464", "1336344478",
                    "1336545827", "1336212539", "1336214425"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1103557394",
                version: "4",
                changeset: "167602972",
                timestamp: "2025-06-14T08:44:01Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336278740", "1336296679", "1336322077", "1336354828", "1336606682",
                    "1336385540", "1336345898", "1336317439", "1336518742", "1336463932",
                    "1336597786", "1336508219", "1336560513", "1336290606", "1336247543",
                    "1336493596", "1336203676", "1336376785", "1336349735", "1336529182",
                    "1336658876", "1336594674", "1336218908", "1336292209", "1336508095",
                    "1336611132", "1336554701", "1336292618", "1336430859", "1336435735",
                    "1336488017", "1336218225", "1336416272", "1336233584", "1336524240",
                    "1336635973", "1336336438", "1336401304", "1336460872", "1336289055",
                    "1336424414", "1336203851", "1336535827", "1336615827", "1336480570",
                    "1336311233", "1336255578", "1336420492", "1336283944", "1336431172",
                    "1336260564", "1336644464", "1336425237"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1103585099",
                version: "2",
                changeset: "172280317",
                timestamp: "2025-09-22T08:15:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "10098574568", "10098574569", "10098574570", "10098574571", 
                    "10098574572", "10098574573", "10098574574", "10098574575", 
                    "10098574576", "10098574577"
                ],
                tags: {
                    "admin_level": "6",
                    "boundary": "administrative"
                }
            },
            {
                id: "1103585100",
                version: "2",
                changeset: "168030709",
                timestamp: "2025-06-24T05:41:19Z",
                user: "Ho√†ng Tu·∫•n Vi·ªát",
                uid: "13707170",
                nodes: [
                    "10098574608", "10098574609", "10098574610", "10098574611", 
                    "10098574612", "10098574613", "10098574614", "10098574615", 
                    "10098335417"
                ],
                tags: {
                    "admin_level": "6",
                    "boundary": "administrative"
                }
            },
            {
                id: "1103585101",
                version: "2",
                changeset: "172280317",
                timestamp: "2025-09-22T08:15:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "10098335434", "10098286216", "10098335417"
                ],
                tags: {
                    "admin_level": "6",
                    "boundary": "administrative"
                }
            },
            {
                id: "1103585106",
                version: "2",
                changeset: "172280317",
                timestamp: "2025-09-22T08:15:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "10098574577", "10098574600", "10098574601", "10098574602", 
                    "10098574603", "10098574604", "10098574605", "10098574606", 
                    "10098574607", "10098574608"
                ],
                tags: {
                    "admin_level": "6",
                    "boundary": "administrative"
                }
            },
            {
                id: "1103585107",
                version: "4",
                changeset: "167602972",
                timestamp: "2025-06-14T08:44:01Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "10098574599", "9282605517", "1336477311", "1336511177", "1336276965",
                    "1336491934", "1336380638", "1336522303", "1336426075", "1336493925",
                    "1336518697", "1336431958", "1336261166", "1336339952", "1336259647",
                    "1336590823", "1336219035", "1336590365", "1336602218", "1336278688",
                    "1336278740"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1103585108",
                version: "1",
                changeset: "127480757",
                timestamp: "2022-10-13T16:53:44Z",
                user: "Ho√†ng Tu·∫•n Vi·ªát",
                uid: "13707170",
                nodes: [
                    "2447429500", "10098580133", "10098580134", "9282576788"
                ],
                tags: {
                    "intermittent": "no",
                    "waterway": "ditch"
                }
            },
            {
                id: "1103585109",
                version: "4",
                changeset: "167602972",
                timestamp: "2025-06-14T08:44:01Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "9282576788", "9282605519", "9282605520", "9282605522", 
                    "9282605523", "9282605524", "10098574599"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1103585110",
                version: "1",
                changeset: "127480757",
                timestamp: "2022-10-13T16:53:44Z",
                user: "Ho√†ng Tu·∫•n Vi·ªát",
                uid: "13707170",
                nodes: [
                    "2447429500", "8915626862", "2447429503", "10098574568"
                ],
                tags: {
                    "waterway": "river"
                }
            },
            {
                id: "1425977506",
                version: "1",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336604783", "1336403028", "1336526634", "1336542346", 
                    "1336334206", "1336643195", "1336515210", "1336394938"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1425977507",
                version: "1",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336214425", "1336604783"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1425977508",
                version: "1",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336415114", "1336544370", "1336596229"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1425977509",
                version: "1",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336342210", "1336415114"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            },
            {
                id: "1425977510",
                version: "1",
                changeset: "171212260",
                timestamp: "2025-08-30T06:42:49Z",
                user: "Kiharu1410",
                uid: "10610073",
                nodes: [
                    "1336425237", "1336298201"
                ],
                tags: {
                    "admin_level": "4",
                    "boundary": "administrative",
                    "name": "Boundary H·∫£i Ph√≤ng - H∆∞ng Y√™n"
                }
            }
        ];
        // T·∫†O MAP T·ª™ ID -> T·ªåA ƒê·ªò
        const nodeMap = {};
        redPoints.forEach(point => {
            nodeMap[point.id.toString()] = [point.lat, point.lon];
        });

        // H√†m n·ªëi c√°c way th√†nh polygon li·ªÅn m·∫°ch
        // H√†m k·∫øt n·ªëi c√°c ways th√†nh m·ªôt polygon li√™n t·ª•c
        function buildConnectedPath(wayCoordsMap) {
            const wayIds = Object.keys(wayCoordsMap);
            if (wayIds.length === 0) return [];
            
            // T·∫°o map ƒë·ªÉ t√¨m c√°c ƒëi·ªÉm k·∫øt n·ªëi
            const connectionMap = {};
            const usedWays = new Set();
            const result = [];
            
            // X√¢y d·ª±ng connection map
            wayIds.forEach(wayId => {
                const coords = wayCoordsMap[wayId];
                if (coords.length >= 2) {
                    const start = `${coords[0][0]},${coords[0][1]}`;
                    const end = `${coords[coords.length-1][0]},${coords[coords.length-1][1]}`;
                    
                    if (!connectionMap[start]) connectionMap[start] = [];
                    if (!connectionMap[end]) connectionMap[end] = [];
                    
                    connectionMap[start].push({wayId, isStart: true, coords});
                    connectionMap[end].push({wayId, isStart: false, coords});
                }
            });
            
            // T√¨m ƒëi·ªÉm b·∫Øt ƒë·∫ßu (ch·ªâ k·∫øt n·ªëi v·ªõi 1 way)
            let startPoint = null;
            for (const point in connectionMap) {
                if (connectionMap[point].length === 1) {
                    startPoint = point;
                    break;
                }
            }
            
            // N·∫øu kh√¥ng t√¨m th·∫•y ƒëi·ªÉm ƒë·∫∑c bi·ªát, d√πng ƒëi·ªÉm ƒë·∫ßu ti√™n
            if (!startPoint) {
                startPoint = Object.keys(connectionMap)[0];
            }
            
            // X√¢y d·ª±ng ƒë∆∞·ªùng d·∫´n li√™n t·ª•c
            let currentPoint = startPoint;
            while (currentPoint && connectionMap[currentPoint]) {
                const connections = connectionMap[currentPoint].filter(conn => !usedWays.has(conn.wayId));
                if (connections.length === 0) break;
                
                const connection = connections[0];
                usedWays.add(connection.wayId);
                
                let coords = connection.coords;
                if (!connection.isStart) {
                    coords = [...coords].reverse(); // ƒê·∫£o ng∆∞·ª£c n·∫øu c·∫ßn
                }
                
                // Th√™m coordinates (b·ªè ƒëi·ªÉm cu·ªëi ƒë·ªÉ tr√°nh tr√πng l·∫∑p)
                result.push(...coords.slice(0, -1));
                
                // T√¨m ƒëi·ªÉm ti·∫øp theo
                const nextPoint = `${coords[coords.length-1][0]},${coords[coords.length-1][1]}`;
                currentPoint = nextPoint;
            }
            
            // Th√™m ƒëi·ªÉm cu·ªëi c√πng
            if (result.length > 0) {
                const lastConnection = wayCoordsMap[Object.keys(wayCoordsMap)[0]];
                if (lastConnection && lastConnection.length > 0) {
                    result.push(lastConnection[lastConnection.length-1]);
                }
            }
            
            return result;
        }

        function connectWaysIntoPolygon(ways, nodeMap) {
            if (ways.length === 0) return [];
            const wayCoordsMap = {};
            ways.forEach(way => {
                const coords = [];
                way.nodes.forEach(nodeId => {
                    if (nodeMap[nodeId]) {
                        coords.push(nodeMap[nodeId]);
                    }
                });
                if (coords.length > 0) {
                    wayCoordsMap[way.id] = coords;
                }
            });
            if (Object.keys(wayCoordsMap).length === 0) return [];
            return buildConnectedPath(wayCoordsMap);
        }

        // Danh s√°ch m√†u cho c√°c way
        const wayColors = [
            'red', 'blue', 'green', 'orange', 'magenta', 'cyan', 'brown',
            'black', 'gold', 'lime', 'navy', 'teal', 'crimson', 'violet'
        ];
        function getWayColor(index) {
            if (index < wayColors.length) return wayColors[index];
            const hue = Math.floor((index * 47) % 360);
            return `hsl(${hue},80%,50%)`;
        }

        // V·∫Ω t·ª´ng way tr√™n b·∫£n ƒë·ªì
        osmWays.forEach((way, idx) => {
            const coords = [];
            way.nodes.forEach(nodeId => {
                if (nodeMap[nodeId]) {
                    coords.push(nodeMap[nodeId]);
                }
            });
            if (coords.length < 2) return;

            const color = getWayColor(idx);
            L.polyline(coords, {
                color: color,
                weight: 5,
                opacity: 0.8,
                smoothFactor: 1
            }).addTo(map).bindPopup(
                `<div class="info">Way ID: ${way.id}<br>S·ªë ƒëi·ªÉm: ${coords.length}<br>T√™n: ${way.tags.name || 'N/A'}</div>`
            );
        });

        // H√†m ki·ªÉm tra c≈© ƒë√£ ƒë∆∞·ª£c thay th·∫ø b·∫±ng logic bounding box m·ªõi

        // CH·ª®C NƒÇNG: Ki·ªÉm tra m·ªôt ƒëi·ªÉm b·∫•t k·ª≥ thu·ªôc x√£ n√†o hay kh√¥ng?
        // D·ªØ li·ªáu x√£ l·∫•y t·ª´ c√°c way c√≥ admin_level = 8 (t√πy v√†o c√°ch m√£ h√≥a d·ªØ li·ªáu OSM)

        // 1. T·∫°o c√°c polygon x√£ (c·∫•p x√£) t·ª´ c√°c ways
        const communePolygons = [];
        osmWays.forEach(way => {
            if (way.tags && way.tags.admin_level === "8") {
                // X√¢y polygon li·ªÅn nhau t·ª´ nodes
                const poly = [];
                way.nodes.forEach(nodeId => {
                    if (nodeMap[nodeId]) {
                        poly.push(nodeMap[nodeId]);
                    }
                });
                if (poly.length >= 3) {
                    communePolygons.push({
                        name: way.tags.name || 'X√£ ch∆∞a r√µ t√™n',
                        polygon: poly
                    });
                }
            }
        });

        // 2. Vi·∫øt h√†m ki·ªÉm tra v√† th√¥ng b√°o x√£ ch·ª©a ƒëi·ªÉm
        // V√≠ d·ª•: ƒëi·ªÉm testPoint = [lat, lon] (vd: 20.6439107,106.4532433)
        function findCommuneForPoint(testPoint) {
            for (let i = 0; i < communePolygons.length; i++) {
                if (isPointInPolygon(testPoint, communePolygons[i].polygon)) {
                    return communePolygons[i].name;
                }
            }
            return null;
        }

        // ƒê√°nh d·∫•u v·ªã tr√≠ ƒëi·ªÉm ki·ªÉm tra tr√™n b·∫£n ƒë·ªì b·∫±ng icon tu·ª≥ ch·ªânh v√† popup
        // T·∫°o icon ƒë√°nh d·∫•u v·ªã tr√≠ ƒëi·ªÉm
        const locationIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -28]
        });



        // C√°c ch·ª©c nƒÉng kh√°c gi·ªØ nguy√™n (v·∫Ω junction, th·ªëng k√™...)
        function getWayJunctionNodes(ways) {
            const nodeCount = {};
            ways.forEach(way => {
                way.nodes.forEach(nodeId => {
                    nodeCount[nodeId] = (nodeCount[nodeId] || 0) + 1;
                });
            });
            const junctionNodeIds = [];
            for (const nodeId in nodeCount) {
                if (nodeCount[nodeId] > 1) {
                    junctionNodeIds.push(nodeId);
                }
            }
            return junctionNodeIds;
        }
        const wayJunctionNodeIds = getWayJunctionNodes(osmWays);
        wayJunctionNodeIds.forEach(nodeId => {
            if (nodeMap[nodeId]) {
                L.circleMarker(nodeMap[nodeId], {
                    radius: 8,
                    color: 'purple',
                    fillColor: 'violet',
                    fillOpacity: 0.95,
      weight: 2
                }).addTo(map).bindPopup(
                    `<div class="info">ƒêi·ªÉm n·ªëi gi·ªØa c√°c way<br>Lat: ${nodeMap[nodeId][0].toFixed(6)}, Lon: ${nodeMap[nodeId][1].toFixed(6)}<br>Node ID: ${nodeId}</div>`
                );
            }
        });

        // V·∫º POLYGON CH√çNH M√ÄU XANH
        const allBoundaryCoords = connectWaysIntoPolygon(osmWays, nodeMap);
        console.log(`Polygon ƒë∆∞·ª£c t·∫°o v·ªõi ${allBoundaryCoords.length} ƒëi·ªÉm`);
        console.log('5 ƒëi·ªÉm ƒë·∫ßu c·ªßa polygon:', allBoundaryCoords.slice(0, 5));
        console.log('5 ƒëi·ªÉm cu·ªëi c·ªßa polygon:', allBoundaryCoords.slice(-5));
        
        if (allBoundaryCoords.length > 0) {
            // H√†m ki·ªÉm tra 2 ƒëi·ªÉm c√≥ g·∫ßn nhau kh√¥ng (ƒë·ªÉ ƒë√≥ng polygon)
            function isCloseEnough(point1, point2, tolerance = 0.00001) {
                if (!point1 || !point2) return false;
                const latDiff = Math.abs(point1[0] - point2[0]);
                const lonDiff = Math.abs(point1[1] - point2[1]);
                return latDiff < tolerance && lonDiff < tolerance;
            }

            // ƒê·∫£m b·∫£o polygon ƒë∆∞·ª£c ƒë√≥ng k√≠n
            if (allBoundaryCoords.length > 0) {
                const first = allBoundaryCoords[0];
                const last = allBoundaryCoords[allBoundaryCoords.length - 1];
                if (!isCloseEnough(first, last)) {
                    allBoundaryCoords.push(first);
                }
            }
            
            // Polygon xanh l√° ƒë√£ ƒë∆∞·ª£c b·ªè ƒëi
            
            // T·ª± ƒë·ªông zoom v√†o v√πng v√† ƒëi·ªÉm ki·ªÉm tra
            if (allBoundaryCoords.length > 0) {
                const bounds = L.latLngBounds(allBoundaryCoords);
                map.fitBounds(bounds.pad(0.1)); // pad 10% ƒë·ªÉ c√≥ kho·∫£ng tr·ªëng
            }
            
            // LOGIC CHECK M·ªöI - KI·ªÇM TRA ƒêI·ªÇM TRONG BOUNDING BOX C·ª¶A V√ôNG
            function isPointInBoundingBox(point, polygonCoords) {
                console.log('=== DEBUG CHECK POINT ===');
                console.log('Point to check:', point);
                console.log('Polygon coords length:', polygonCoords ? polygonCoords.length : 'null/undefined');
                console.log('First few coords:', polygonCoords ? polygonCoords.slice(0, 3) : 'null/undefined');
                
                if (!polygonCoords || polygonCoords.length === 0) {
                    console.log('No polygon coordinates available!');
                    return false;
                }
                
                let minLat = polygonCoords[0][0];
                let maxLat = polygonCoords[0][0];
                let minLon = polygonCoords[0][1];
                let maxLon = polygonCoords[0][1];
                
                // T√¨m bounding box c·ªßa polygon
                polygonCoords.forEach((coord, index) => {
                    if (coord && coord.length >= 2) {
                        minLat = Math.min(minLat, coord[0]);
                        maxLat = Math.max(maxLat, coord[0]);
                        minLon = Math.min(minLon, coord[1]);
                        maxLon = Math.max(maxLon, coord[1]);
                    } else {
                        console.log(`Invalid coord at index ${index}:`, coord);
                    }
                });
                
                // Ki·ªÉm tra ƒëi·ªÉm c√≥ n·∫±m trong bounding box kh√¥ng
                const inBoundingBox = point[0] >= minLat && point[0] <= maxLat && 
                                    point[1] >= minLon && point[1] <= maxLon;
                
                console.log('Bounding box c·ªßa v√πng:', {minLat, maxLat, minLon, maxLon});
                console.log('ƒêi·ªÉm ki·ªÉm tra:', point);
                console.log('Ki·ªÉm tra lat:', `${point[0]} >= ${minLat} && ${point[0]} <= ${maxLat} = ${point[0] >= minLat && point[0] <= maxLat}`);
                console.log('Ki·ªÉm tra lon:', `${point[1]} >= ${minLon} && ${point[1]} <= ${maxLon} = ${point[1] >= minLon && point[1] <= maxLon}`);
                console.log('ƒêi·ªÉm c√≥ n·∫±m trong v√πng:', inBoundingBox);
                console.log('=== END DEBUG ===');
                
                return inBoundingBox;
            }
            
            // Debug allBoundaryCoords tr∆∞·ªõc khi check
            console.log('allBoundaryCoords:', allBoundaryCoords);
            console.log('allBoundaryCoords length:', allBoundaryCoords ? allBoundaryCoords.length : 'null');
            
            // S·ª≠ d·ª•ng allBoundaryCoords tr·ª±c ti·∫øp
            let coordsToCheck = allBoundaryCoords;
            
            // S·ª≠ d·ª•ng logic m·ªõi
            const finalResult = isPointInBoundingBox(testPoint, coordsToCheck);
            
            // Fallback: s·ª≠ d·ª•ng Leaflet's built-in method v·ªõi bounds
            let leafletResult = false;
            try {
                if (allBoundaryCoords.length > 0) {
                    const bounds = L.latLngBounds(allBoundaryCoords);
                    const pointLatLng = L.latLng(testPoint[0], testPoint[1]);
                    leafletResult = bounds.contains(pointLatLng);
                    console.log('Leaflet bounds check result:', leafletResult);
                }
            } catch (e) {
                console.log('Leaflet bounds check failed:', e);
            }
            
            // S·ª≠ d·ª•ng k·∫øt qu·∫£ t·ªët h∆°n
            const bestResult = finalResult || leafletResult;
            
            console.log(`ƒêi·ªÉm ki·ªÉm tra: [${testPoint[0]}, ${testPoint[1]}] - K·∫øt qu·∫£: ${bestResult ? 'TRONG' : 'NGO√ÄI'} v√πng`);
                         
            // V·∫Ω ƒëi·ªÉm test v·ªõi m√†u ƒë·ªè to ƒë·ªÉ d·ªÖ nh√¨n
            const testMarker = L.marker(testPoint, {
                icon: L.divIcon({
                    className: 'test-point-marker',
                    html: '<div style="background: red; width: 25px; height: 25px; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 15px rgba(255,0,0,0.8);"></div>',
                    iconSize: [25, 25],
                    iconAnchor: [12, 12]
                })
    }).addTo(map);

            testMarker.bindPopup(`
                <div class="info">
                    <h3>ƒêi·ªÉm ki·ªÉm tra</h3>
                    <p><strong>V·ªã tr√≠:</strong> ${bestResult ? 'N·∫±m TRONG' : 'N·∫±m NGO√ÄI'} v√πng</p>
                    <p><strong>Lat:</strong> ${testPoint[0]}</p>
                    <p><strong>Lon:</strong> ${testPoint[1]}</p>
                    <button onclick="map.setView([${testPoint[0]}, ${testPoint[1]}], 14); this.parentElement.parentElement.close()">üîç Zoom chi ti·∫øt</button>
                </div>
            `);
            
            // Th√™m n√∫t ƒëi·ªÅu khi·ªÉn ƒë·ªÉ zoom v√†o ƒëi·ªÉm
            const zoomControl = L.control({position: 'topright'});
            zoomControl.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'leaflet-control-custom');
                div.innerHTML = '<button style="background: white; border: 2px solid #ccc; padding: 10px; cursor: pointer; border-radius: 5px; font-size: 14px;">üîç Zoom v√†o ƒëi·ªÉm</button>';
                div.onclick = function() {
                    map.setView(testPoint, 14);
                    testMarker.openPopup();
                };
                return div;
            };
            zoomControl.addTo(map);
            
            // Th√™m n√∫t chuy·ªÉn ƒë·ªïi map style OSM
            const mapStyleControl = L.control({position: 'topleft'});
            mapStyleControl.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'leaflet-control-custom');
                div.innerHTML = '<button style="background: white; border: 2px solid #ccc; padding: 10px; cursor: pointer; border-radius: 5px; font-size: 14px;">üó∫Ô∏è ƒê·ªïi style OSM</button>';
                let currentStyle = 'standard';
                div.onclick = function() {
                    // X√≥a layer c≈©
                    map.eachLayer(function(layer) {
                        if (layer instanceof L.TileLayer) {
                            map.removeLayer(layer);
                        }
                    });
                    
                    // Th√™m layer m·ªõi
                    if (currentStyle === 'standard') {
                        // Chuy·ªÉn sang OSM Transport
                        L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=6170aad10dfd42a38d4d8c709a536f38', {
                            maxZoom: 19,
                            attribution: '¬© OpenStreetMap contributors ¬© Thunderforest'
                        }).addTo(map);
                        currentStyle = 'transport';
                    } else if (currentStyle === 'transport') {
                        // Chuy·ªÉn sang OSM Outdoors
                        L.tileLayer('https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey=6170aad10dfd42a38d4d8c709a536f38', {
                            maxZoom: 19,
                            attribution: '¬© OpenStreetMap contributors ¬© Thunderforest'
                        }).addTo(map);
                        currentStyle = 'outdoors';
                    } else {
                        // Chuy·ªÉn v·ªÅ OSM Standard
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                            attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
                        currentStyle = 'standard';
                    }
                };
                return div;
            };
            mapStyleControl.addTo(map);
        }


        // Logic check m·ªõi ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p ·ªü tr√™n

        // Th·ªëng k√™
        console.log(`T·ªïng s·ªë ways: ${osmWays.length}`);
        osmWays.forEach(way => {
            console.log(`Way ${way.id}: ${way.nodes.length} nodes, Admin Level: ${way.tags.admin_level || 'N/A'}`);
        });
           
          
  </script>
</body>
</html>
